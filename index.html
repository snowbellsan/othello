<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„Ç™„Çª„É≠„Ç≤„Éº„É†</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #1e7e34 0%, #28a745 50%, #20c997 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: moveGrid 20s linear infinite;
      z-index: 0;
    }

    @keyframes moveGrid {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    .container {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 500px;
      padding: 10px;
      max-height: 100vh;
      overflow-y: auto;
    }

    #titleScreen, #gameScreen {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
    }

    h1 {
      text-align: center;
      font-size: 2.5em;
      color: #1e7e34;
      margin-bottom: 20px;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.1);
      animation: titlePulse 2s ease-in-out infinite;
    }

    @keyframes titlePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .settings-section {
      margin-bottom: 20px;
    }

    .settings-section label {
      display: block;
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .difficulty-buttons, .hint-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .setting-btn {
      padding: 12px;
      font-size: 1em;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    .setting-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .setting-btn.selected {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      transform: scale(1.02);
    }

    .setting-btn:not(.selected) {
      background: #e9ecef;
      color: #495057;
    }

    .start-btn {
      width: 100%;
      padding: 15px;
      font-size: 1.2em;
      font-weight: bold;
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,123,255,0.4);
      margin-top: 15px;
    }

    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,123,255,0.5);
    }

    .score-board {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 12px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .player-score {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stone-display {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
      position: relative;
    }

    .stone-display.black {
      background: radial-gradient(circle at 30% 30%, #4a4a4a, #000);
    }

    .stone-display.white {
      background: radial-gradient(circle at 30% 30%, #fff, #ddd);
      border: 2px solid #999;
    }

    .stone-display::after {
      content: '';
      position: absolute;
      top: 15%;
      left: 20%;
      width: 40%;
      height: 40%;
      background: radial-gradient(circle, rgba(255,255,255,0.6), transparent);
      border-radius: 50%;
    }

    .score-number {
      font-size: 1.5em;
      font-weight: bold;
      color: #333;
      min-width: 40px;
      text-align: center;
    }

    .game-status {
      text-align: center;
    }

    .difficulty-display {
      font-size: 0.75em;
      color: #666;
      margin-bottom: 3px;
    }

    .turn-display {
      font-size: 1.1em;
      font-weight: bold;
      color: #1e7e34;
    }

    .game-over {
      color: #7b1fa2;
      font-size: 1.2em;
    }

    .board-container {
      display: inline-block;
      background: linear-gradient(135deg, #2d5016, #1e7e34);
      padding: 10px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 2px 8px rgba(0,0,0,0.3);
    }

    .board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 1px;
      background: #1a5c28;
      border-radius: 8px;
      overflow: hidden;
    }

    .cell {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #2d7a3e, #238c41);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
    }

    .cell:hover {
      background: linear-gradient(135deg, #3a8f4f, #2ea04d);
    }

    .cell::after {
      content: '';
      position: absolute;
      inset: 2px;
      border: 1px solid rgba(0,0,0,0.2);
      border-radius: 3px;
      pointer-events: none;
    }

    .stone {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      position: relative;
      box-shadow: 0 5px 12px rgba(0,0,0,0.4);
      animation: placeStone 0.3s ease-out;
    }

    @keyframes placeStone {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .stone.black {
      background: radial-gradient(circle at 35% 35%, #4a4a4a, #000);
    }

    .stone.white {
      background: radial-gradient(circle at 35% 35%, #fff, #ddd);
      border: 2px solid #999;
    }

    .stone::after {
      content: '';
      position: absolute;
      top: 20%;
      left: 25%;
      width: 40%;
      height: 40%;
      background: radial-gradient(circle, rgba(255,255,255,0.7), transparent);
      border-radius: 50%;
    }

    .stone.flipping {
      animation: flipStone 0.4s ease-in-out;
    }

    @keyframes flipStone {
      0%, 100% { transform: rotateY(0deg); }
      50% { transform: rotateY(180deg); }
    }

    .valid-hint {
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #90ee90, #4caf50);
      border-radius: 50%;
      opacity: 0.7;
      animation: pulse 1.5s ease-in-out infinite;
      box-shadow: 0 0 8px rgba(76,175,80,0.6);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.3); opacity: 1; }
    }

    .back-btn {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      font-size: 1em;
      font-weight: bold;
      background: linear-gradient(135deg, #6c757d, #495057);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 3px 12px rgba(108,117,125,0.4);
    }

    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(108,117,125,0.5);
    }

    .hidden {
      display: none !important;
    }

    .center {
      text-align: center;
    }

    .winner-display {
      font-size: 0.95em;
      margin-top: 3px;
      color: #7b1fa2;
      font-weight: bold;
    }

    .no-moves-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .no-moves-message {
      background: white;
      padding: 30px 40px;
      border-radius: 20px;
      font-size: 1.5em;
      font-weight: bold;
      color: #d32f2f;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      animation: scaleIn 0.3s ease-out;
      text-align: center;
    }

    @keyframes scaleIn {
      from { transform: scale(0.8); }
      to { transform: scale(1); }
    }

    @media (max-width: 600px) {
      .container { padding: 5px; }
      #titleScreen, #gameScreen { padding: 15px; border-radius: 15px; }
      h1 { font-size: 2em; margin-bottom: 15px; }
      .cell { width: 45px; height: 45px; }
      .stone { width: 38px; height: 38px; }
      .board-container { padding: 8px; }
      .no-moves-message { padding: 25px 30px; font-size: 1.3em; }
    }

    @media (max-width: 400px) {
      h1 { font-size: 1.8em; }
      .cell { width: 40px; height: 40px; }
      .stone { width: 34px; height: 34px; }
      .score-number { font-size: 1.3em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="titleScreen">
      <h1></h1>
      
      <div class="settings-section">
        <label>Èõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû</label>
        <div class="difficulty-buttons">
          <button class="setting-btn" data-difficulty="easy">üåü „ÇÑ„Åï„Åó„ÅÑ</button>
          <button class="setting-btn selected" data-difficulty="normal">‚ö° „Åµ„Å§„ÅÜ</button>
          <button class="setting-btn" data-difficulty="hard">üî• „ÇÄ„Åö„Åã„Åó„ÅÑ</button>
        </div>
      </div>

      <div class="settings-section">
        <label>„Éí„É≥„ÉàË°®Á§∫</label>
        <div class="hint-buttons">
          <button class="setting-btn selected" data-hint="on">üí° „Ç™„É≥</button>
          <button class="setting-btn" data-hint="off">üö´ „Ç™„Éï</button>
        </div>
      </div>

      <button class="start-btn" onclick="startGame()">„Ç≤„Éº„É†ÈñãÂßã</button>
    </div>

    <div id="gameScreen" class="hidden">
      <div class="score-board">
        <div class="player-score">
          <div class="stone-display black"></div>
          <div class="score-number" id="blackScore">2</div>
        </div>
        <div class="game-status">
          <div class="difficulty-display" id="difficultyDisplay">„Åµ„Å§„ÅÜ</div>
          <div class="turn-display" id="turnDisplay">„ÅÇ„Å™„Åü„ÅÆÁï™</div>
          <div class="winner-display" id="winnerDisplay"></div>
        </div>
        <div class="player-score">
          <div class="score-number" id="whiteScore">2</div>
          <div class="stone-display white"></div>
        </div>
      </div>
      
      <div class="center">
        <div class="board-container">
          <div class="board" id="board"></div>
        </div>
      </div>

      <button class="back-btn" onclick="backToTitle()">„Çø„Ç§„Éà„É´„Å´Êàª„Çã</button>
    </div>
  </div>

  <div id="noMovesOverlay" class="no-moves-overlay">
    <div class="no-moves-message">
      ÁΩÆ„Åè„Å®„Åì„Çç„Åå<br>„ÅÇ„Çä„Åæ„Åõ„ÇìÔºÅ
    </div>
  </div>

  <script>
    let board = [];
    let currentPlayer = 'black';
    let difficulty = 'normal';
    let showHints = true;
    let gameOver = false;
    let flippingCells = new Set();
    let validMoves = [];

    const directions = [
      [-1, -1], [-1, 0], [-1, 1],
      [0, -1], [0, 1],
      [1, -1], [1, 0], [1, 1]
    ];

    document.querySelectorAll('.difficulty-buttons .setting-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.difficulty-buttons .setting-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        difficulty = btn.dataset.difficulty;
      });
    });

    document.querySelectorAll('.hint-buttons .setting-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.hint-buttons .setting-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        showHints = btn.dataset.hint === 'on';
      });
    });

    document.getElementById('noMovesOverlay').addEventListener('click', function() {
      this.style.display = 'none';
    });

    function initBoard() {
      board = Array(8).fill(null).map(() => Array(8).fill(null));
      board[3][3] = 'white';
      board[3][4] = 'black';
      board[4][3] = 'black';
      board[4][4] = 'white';
    }

    function startGame() {
      document.getElementById('titleScreen').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');
      document.getElementById('noMovesOverlay').style.display = 'none';
      
      const diffNames = { easy: '„ÇÑ„Åï„Åó„ÅÑ', normal: '„Åµ„Å§„ÅÜ', hard: '„ÇÄ„Åö„Åã„Åó„ÅÑ' };
      document.getElementById('difficultyDisplay').textContent = diffNames[difficulty];
      
      initBoard();
      currentPlayer = 'black';
      gameOver = false;
      flippingCells.clear();
      document.getElementById('winnerDisplay').textContent = '';
      document.getElementById('turnDisplay').classList.remove('game-over');
      renderBoard();
      calculateValidMoves('black');
      updateScores();
    }

    function backToTitle() {
      document.getElementById('gameScreen').classList.add('hidden');
      document.getElementById('titleScreen').classList.remove('hidden');
      document.getElementById('noMovesOverlay').style.display = 'none';
    }

    function renderBoard() {
      const boardEl = document.getElementById('board');
      boardEl.innerHTML = '';
      
      for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.row = i;
          cell.dataset.col = j;
          
          if (board[i][j]) {
            const stone = document.createElement('div');
            stone.className = 'stone ' + board[i][j];
            if (flippingCells.has(i + ',' + j)) {
              stone.classList.add('flipping');
            }
            cell.appendChild(stone);
          } else if (showHints && currentPlayer === 'black' && isValidMovePosition(i, j)) {
            const hint = document.createElement('div');
            hint.className = 'valid-hint';
            cell.appendChild(hint);
          }
          
          cell.addEventListener('click', () => handleCellClick(i, j));
          boardEl.appendChild(cell);
        }
      }
    }

    function isValidMove(row, col, player) {
      if (board[row][col] !== null) return [];
      
      const opponent = player === 'black' ? 'white' : 'black';
      const toFlip = [];

      for (const dir of directions) {
        const dx = dir[0];
        const dy = dir[1];
        const path = [];
        let x = row + dx;
        let y = col + dy;

        while (x >= 0 && x < 8 && y >= 0 && y < 8 && board[x][y] === opponent) {
          path.push([x, y]);
          x += dx;
          y += dy;
        }

        if (path.length > 0 && x >= 0 && x < 8 && y >= 0 && y < 8 && board[x][y] === player) {
          toFlip.push(...path);
        }
      }

      return toFlip;
    }

    function calculateValidMoves(player) {
      validMoves = [];
      for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
          if (board[i][j] === null && isValidMove(i, j, player).length > 0) {
            validMoves.push([i, j]);
          }
        }
      }
      return validMoves;
    }

    function isValidMovePosition(row, col) {
      return validMoves.some(m => m[0] === row && m[1] === col);
    }

    function handleCellClick(row, col) {
      if (gameOver || currentPlayer === 'white') return;
      
      const toFlip = isValidMove(row, col, 'black');
      if (toFlip.length === 0) return;

      makeMove(row, col, toFlip, 'black');
    }

    function showNoMovesMessage() {
      document.getElementById('noMovesOverlay').style.display = 'flex';
    }

    function makeMove(row, col, toFlip, player) {
      board[row][col] = player;
      
      flippingCells.clear();
      toFlip.forEach(pos => flippingCells.add(pos[0] + ',' + pos[1]));
      
      renderBoard();
      
      setTimeout(() => {
        toFlip.forEach(pos => {
          board[pos[0]][pos[1]] = player;
        });
        flippingCells.clear();
        renderBoard();
        updateScores();
        
        const nextPlayer = player === 'black' ? 'white' : 'black';
        const nextMoves = calculateValidMoves(nextPlayer);
        
        if (nextMoves.length === 0) {
          showNoMovesMessage();
          const backMoves = calculateValidMoves(player);
          if (backMoves.length === 0) {
            endGame();
          } else {
            currentPlayer = player;
            updateTurnDisplay();
            if (currentPlayer === 'white') {
              setTimeout(makeAIMove, 1500);
            }
          }
        } else {
          currentPlayer = nextPlayer;
          updateTurnDisplay();
          
          if (currentPlayer === 'white') {
            setTimeout(makeAIMove, 500);
          }
        }
      }, 400);
    }

    function makeAIMove() {
      const moves = [];
      for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
          const toFlip = isValidMove(i, j, 'white');
          if (toFlip.length > 0) {
            moves.push({ row: i, col: j, flips: toFlip });
          }
        }
      }

      if (moves.length === 0) {
        showNoMovesMessage();
        const backMoves = calculateValidMoves('black');
        if (backMoves.length === 0) {
          endGame();
        } else {
          currentPlayer = 'black';
          updateTurnDisplay();
        }
        return;
      }

      let bestMove;
      if (difficulty === 'easy') {
        bestMove = moves[Math.floor(Math.random() * moves.length)];
      } else if (difficulty === 'normal') {
        bestMove = moves.reduce((best, move) => 
          move.flips.length > best.flips.length ? move : best
        );
      } else {
        bestMove = moves.reduce((best, move) => {
          const testBoard = board.map(row => [...row]);
          testBoard[move.row][move.col] = 'white';
          move.flips.forEach(pos => {
            testBoard[pos[0]][pos[1]] = 'white';
          });
          const score = evaluateBoard(testBoard);
          return score > (best.score || -Infinity) ? { ...move, score } : best;
        }, {});
      }

      makeMove(bestMove.row, bestMove.col, bestMove.flips, 'white');
    }

    function evaluateBoard(testBoard) {
      const weights = [
        [100, -20, 10, 5, 5, 10, -20, 100],
        [-20, -50, -2, -2, -2, -2, -50, -20],
        [10, -2, 5, 1, 1, 5, -2, 10],
        [5, -2, 1, 0, 0, 1, -2, 5],
        [5, -2, 1, 0, 0, 1, -2, 5],
        [10, -2, 5, 1, 1, 5, -2, 10],
        [-20, -50, -2, -2, -2, -2, -50, -20],
        [100, -20, 10, 5, 5, 10, -20, 100]
      ];

      let score = 0;
      for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
          if (testBoard[i][j] === 'white') score += weights[i][j];
          if (testBoard[i][j] === 'black') score -= weights[i][j];
        }
      }
      return score;
    }

    function updateScores() {
      let black = 0;
      let white = 0;
      for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
          if (board[i][j] === 'black') black++;
          if (board[i][j] === 'white') white++;
        }
      }
      document.getElementById('blackScore').textContent = black;
      document.getElementById('whiteScore').textContent = white;
      
      if (black + white === 64 || black === 0 || white === 0) {
        endGame();
      }
    }

    function updateTurnDisplay() {
      const turnEl = document.getElementById('turnDisplay');
      turnEl.textContent = currentPlayer === 'black' ? '„ÅÇ„Å™„Åü„ÅÆÁï™' : 'CPU„ÅÆÁï™';
      renderBoard();
    }

    function endGame() {
      gameOver = true;
      const black = parseInt(document.getElementById('blackScore').textContent);
      const white = parseInt(document.getElementById('whiteScore').textContent);
      
      const turnEl = document.getElementById('turnDisplay');
      turnEl.textContent = '„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅ';
      turnEl.classList.add('game-over');
      
      const winnerEl = document.getElementById('winnerDisplay');
      if (black > white) {
        winnerEl.textContent = 'üéâ Èªí„ÅÆÂãù„Å°ÔºÅ';
      } else if (white > black) {
        winnerEl.textContent = 'üí´ ÁôΩ„ÅÆÂãù„Å°ÔºÅ';
      } else {
        winnerEl.textContent = 'ü§ù Âºï„ÅçÂàÜ„ÅëÔºÅ';
      }
    }
  </script>
</body>
</html>